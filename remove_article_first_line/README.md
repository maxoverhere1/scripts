# Remove Article First Line

This script removes the first heading/text from articles that have duplicate titles (where the page heading matches the article's first text).

## Purpose

Fixes duplicate titles by:
1. Reading the `duplicate_titles.csv` generated by the `find_double_title` script
2. For each page, fetching the linked article
3. Removing the first text node (heading or paragraph) from the article's RichText content
4. Updating the article in Contentful

This eliminates redundant titles that appear both in the page heading and at the start of the article.

## Setup

1. Install dependencies:
   ```bash
   pip3 install -r requirements.txt
   ```

2. Configure environment:
   ```bash
   cp env.example .env
   # Edit .env with your Contentful credentials
   ```

3. Required environment variables in `.env`:
   - `CONTENTFUL_SPACE_ID` - Your Contentful space ID
   - `CONTENTFUL_ENVIRONMENT_ID` - Environment (e.g., master, staging)
   - `CONTENTFUL_MANAGEMENT_TOKEN` - Management API token (needs write access)

## Usage

### Dry Run (Preview Changes)
Run without making any changes to see what would be updated:
```bash
python3 main.py
```

### Live Mode (Actually Update)
To actually update the articles in Contentful:
```bash
python3 main.py --live
```

You'll be prompted to confirm before any changes are made.

## Input

Reads from: `../find_double_title/generated/duplicate_titles.csv`

The CSV should have these columns:
- `slug` - Page URL slug
- `page_id` - Contentful page entry ID
- `title` - The duplicate title

## How It Works

1. **Read CSV**: Loads all pages with duplicate titles
2. **Fetch Page**: Gets the page entry and finds the linked article
3. **Analyze Article**: Examines the article's RichText content
4. **Remove First Node**: Removes the first heading or paragraph that contains text
5. **Update**: Saves the modified article (only in live mode)

## Example Output

```
üîß Article First Line Remover
============================================================

=== Reading duplicate titles CSV ===
‚úÖ Read 681 pages from ../find_double_title/generated/duplicate_titles.csv

============================================================
Mode: DRY RUN (no changes will be saved)
============================================================

[1/681] Processing: painting-path-painting
  Page ID: 3uTr7cH1lHb0ZIi3lsU5dJ
  Title: Painting path brush strokes
  Article ID: 5xYz9aBcDeFgHiJkLmNoPq
  Processing locale: en-US
    Removing node type: heading-1
    ‚ÑπÔ∏è  Would update article (dry run)

[2/681] Processing: filters-filter-twirl
  Page ID: 6lUATYv9e0ewO0xovkaFRp
  Title: Twirl
  Article ID: 7rStUvWxYz1AbCdEfGhIjK
  Processing locale: en-US
    Removing node type: heading-2
    ‚ÑπÔ∏è  Would update article (dry run)

...

============================================================
üìä Summary:
  Total pages: 681
  Updated: 650
  Skipped: 20
  Errors: 11
============================================================

üí° This was a dry run. No changes were made.
   To actually update articles, run: python3 main.py --live
```

## Safety Features

- **Dry Run by Default**: Preview changes before applying them
- **Confirmation Prompt**: Live mode requires explicit confirmation
- **Per-Locale Processing**: Handles all localized content properly
- **Error Handling**: Continues processing even if individual updates fail
- **No Deletion**: Only removes the first text node, preserves all other content

## Notes

- Requires **Management API** access with write permissions
- Only removes the **first** heading or paragraph that contains text
- Processes all locales for each article
- Works with all RichText node types (heading-1 through heading-6, paragraph)
- Preserves empty nodes and non-text content
- Does not publish changes automatically - entries remain in draft state

## Warning

‚ö†Ô∏è **Always run in dry-run mode first** to verify the changes before using `--live` mode!

